<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>通过demo学习OpenStack开发所需的基础知识 -- 单元测试</title>
  <meta name="description" content="本文将进入单元测试的部分，这也是基础知识中最后一个大块。本文将重点讲述Python和OpenStack中的单元测试的生态环境。">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://diabloneo.github.io//2016/03/13/learn-openstack-dev-skill-by-demo-08.html">
  <link rel="alternate" type="application/rss+xml" title="Coffee, Coke and Code" href="http://diabloneo.github.io//feed.xml">
</head>


  <body>
    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Coffee, Coke and Code</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
        <a href="/feed.xml">RSS</a>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">通过demo学习OpenStack开发所需的基础知识 -- 单元测试</h1>
    <p class="post-meta"><time datetime="2016-03-13T00:00:00+08:00" itemprop="datePublished">Mar 13, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>本文将进入单元测试的部分，这也是基础知识中最后一个大块。本文将重点讲述Python和OpenStack中的单元测试的生态环境。</p>

<h1 id="单元测试的重要性">单元测试的重要性</h1>

<p>github上有个人画了一些不同语言的学习曲线图：<a href="https://github.com/dobiasd/articles/blob/master/programming_language_learning_curves.md">Learning Curves (for different programming languages)</a>，虽然有些恶搞的倾向，不过确实说明了问题。这里贴一下Python的部分：</p>

<p><img src="http://diabloneo.github.io//assets/imgs/00008_python_learning_curve.png" alt="Python Learning Curve" /></p>

<p>这个图说明了，会单元测试对于提高Python生产力的重要性，这主要是因为Python是个动态语言，很多问题都无法通过静态编译检查来发现，因此单元测试就成了一个重要的确保质量的手段。OpenStack的核心项目都对单元测试有极高的要求，以保证项目的高质量。</p>

<h1 id="单元测试工具">单元测试工具</h1>

<p>Python的单元测试工具很多，为单元测试提供不同方面的功能。OpenStack的项目也基本把现在流行的单元测试工具都用全了。单元测试可以说是入门OpenStack开发的最难的部分，也是最后一公里。本章，我们就介绍一下在OpenStack中会用到的单元测试的工具。由于数量很多，不可能详细介绍，因此主要做一些概念和用途上的介绍。</p>

<h2 id="unittest">unittest</h2>

<p>unittest是Python的标准库，提供了最基本的单元测试功能，包括单元测试运行器（简称runner）和单元测试框架。项目的单元测试代码的测试类可以继承<code class="highlighter-rouge">unittest.TestCase</code>类，这样这个类就能够被runner发现并且执行。同时，<code class="highlighter-rouge">unittest.TestCase</code>这个类还定义了<code class="highlighter-rouge">setUp()</code>，<code class="highlighter-rouge">tearDown()</code>，<code class="highlighter-rouge">setUpClass()</code>和<code class="highlighter-rouge">tearDownClass()</code>方法，是用来运行单元测试前的设置工作代码和单元测试后的清理工作代码，这个也是所有Python代码遵守的规范，所以第三方的单元测试库和框架也都遵循这个规范。</p>

<p>unittest库也提供了一个runner，可以使用<code class="highlighter-rouge">$ python -m unittest test_module</code>的命令来执行某个模块的单元测试。另外，在Python中指定要运行的单元测试用例的完整语法是：<strong>path.to.your.module:ClassOfYourTest.test_method</strong>。</p>

<p>unittest是学习Python单元测试最基本也最重要的一个库，完整的说明请查看官方文档：<a href="https://docs.python.org/2.7/library/unittest.html">https://docs.python.org/2.7/library/unittest.html</a>。</p>

<h2 id="mock">mock</h2>

<p>mock也是另一个重要的单元测试库，在Python 2中是作为一个第三方库被使用的，到Python 3时，就被纳入了标准库，可见这个库的重要性。简单的说，mock就是用来模拟对象的行为，这样在进行单元测试的时候，可以指定任何对象的返回值，便于测试对外部接口有依赖的代码。关于mock的使用，可以查看我之前写的这篇文章<a href="https://segmentfault.com/a/1190000002965620">Python Mock的入门</a></p>

<h2 id="testtools">testtools</h2>

<p>testtools是个unittest的扩展框架，主要是在unittest的基础上提供了更好的assert功能，使得写单元测试更加方便。具体可以查看文档：<a href="http://testtools.readthedocs.org/en/latest/">http://testtools.readthedocs.org/en/latest/</a>。</p>

<h2 id="fixtures">fixtures</h2>

<p>fixture的意思是固定装置，在Python的单元测试中，是指某段可以复用的单元测试<code class="highlighter-rouge">setUp</code>和<code class="highlighter-rouge">tearDown</code>代码组合。一个fixture一般用来实现某个组件的setUp和tearDown逻辑，比如测试前要先创建好某些数据，测试后要删掉这些数据，这些操作就可以封装到一个fixture中。这样不同的测试用例就不用重复写这些代码，只要使用fixture即可。fixtures模块是一个第三方模块，提供了一种简单的创建fixture类和对象的机制，并且也提供了一些内置的fixture。具体的使用方法可以查看官方文档：<a href="https://pypi.python.org/pypi/fixtures/">https://pypi.python.org/pypi/fixtures/</a>。</p>

<h2 id="testscenarios">testscenarios</h2>

<p>testscenarios模块满足了场景测试的需求。它的基本用法是在测试类中添加一个类属性<code class="highlighter-rouge">scenarios</code>，该属性是一个元组，定义了每一种场景下不同的变量的值。比如说你测试一段数据访问代码，你需要测试该代码在使用不同的驱动时，比如MongoDB、SQL、File，是否都能正常工作。我们有三种办法：</p>

<ol>
  <li>最笨的办法是为不同的驱动把同一个测试用例编写3遍。</li>
  <li>比较好的办法是，编写一个统一的非测试用例方法，接收driver作为参数，执行测试逻辑，然后再分别编写三个测试用例方法去调用这个非测试用例方法。</li>
  <li>更好的办法就是使用testscenarios模块，定义好scenarios变量，然后实现一个测试用例方法。</li>
</ol>

<p>testscenarios模块在OpenStack Ceilometer中被大量使用。更多的信息可以查看文档：<a href="https://pypi.python.org/pypi/testscenarios/">https://pypi.python.org/pypi/testscenarios/</a></p>

<h2 id="subunit">subunit</h2>

<p>subunit是一个用于传输单元测试结果的流协议。一般来说，运行单元测试的时候是把单元测试的结果直接输出到标准输出，但是如果运行大量的测试用例，这些测试结果就很难被分析。因此就可以使用python-subunit模块来运行测试用例，并且把测试用例通过subunit协议输出，这样测试结果就可以被分析工具聚合以及分析。python-subunit模块自带了一些工具用来解析subunit协议，比如你可以这样运行测试用例：<code class="highlighter-rouge">$ python -m subunit.run test_module | subunit2pyunit</code>，<code class="highlighter-rouge">subunit2pyunit</code>命令会解析subunit协议，并且输出到标准输出。关于subunit的更多信息，请查看官方文档：<a href="https://pypi.python.org/pypi/python-subunit/">https://pypi.python.org/pypi/python-subunit/</a>。</p>

<h2 id="testrepository">testrepository</h2>

<p>OpenStack中使用testrepository模块管理单元测试用例。当一个项目中的测试用例很多时，如何更有效的处理单元测试用例的结果就变得很重要。testrepository的出现就是为了解决这个问题。testrepository使用python-subunit模块来运行测试用例，然后分析subunit的输出并对测试结果进行记录（记录到本地文件）。举例来说，testrepository允许你做这样的事情：</p>

<ul>
  <li>知道哪些用例运行时间最长</li>
  <li>显示运行失败的用例</li>
  <li>重新运行上次运行失败的用例</li>
</ul>

<p>testrepository的更多信息，请查看官方文档：<a href="http://testrepository.readthedocs.org/en/latest/">http://testrepository.readthedocs.org/en/latest/</a>。</p>

<h2 id="coverage">coverage</h2>

<p>coverage是用来计算代码运行时的覆盖率的，也就是统计多少代码被执行了。它可以和testrepository一起使用，用来统计单元测试的覆盖率，在运行完单元测试之后，输出覆盖率报告。具体的使用方法可以查看官方文档：<a href="http://coverage.readthedocs.org/en/latest/">http://coverage.readthedocs.org/en/latest/</a>。</p>

<h2 id="tox">tox</h2>

<p>tox是用来管理和构建虚拟环境(virtualenv)的。对于一个项目，我们需要运行Python 2.7的单元测试，也需要运行Python 3.4的单元测试，还需要运行PEP8的代码检查。这些不同的任务需要依赖不同的库，所以需要使用不同的虚拟环境。使用tox的时候，我们会在tox的配置文件<strong>tox.ini</strong>中指定不同任务的虚拟环境名称，该任务在虚拟环境中需要安装哪些包，以及该任务执行的时候需要运行哪些命令。更多信息，请查看官方文档：<a href="https://testrun.org/tox/latest/">https://testrun.org/tox/latest/</a></p>

<h2 id="单元测试工具小结">单元测试工具小结</h2>

<p>本章介绍了OpenStack中常用的单元测试工具的基本用途，希望大家对这些工具有个大概的认识。这里我们可以按照类别总结一下这些工具：</p>

<ul>
  <li><strong>测试环境管理</strong>: tox
使用tox来管理测试运行的虚拟环境，并且调用testrepository来执行测试用例。</li>
  <li><strong>测试用例的运行和管理</strong>: testrepository, subunit, coverage
testrepository调用subunit来执行测试用例，对测试结果进行聚合和管理；调用coverage来执行代码覆盖率的计算。</li>
  <li><strong>测试用例的编写</strong>: unittest, mock, testtools, fixtures, testscenarios
使用testtools作为所有测试用例的基类，同时应用mock, fixtures, testscenarios来更好的编写测试用例。</li>
</ul>

<p>在<em>The Hacker’s Guide to Python</em>（《Python高手之路》）一书中，也有专门的一章介绍了各种单元测试工具及其用法，读者也可以参考一下。下一章，我们来分析Keystone项目的单元测试框架，可以让你看到在OpenStack的实际项目中，这些工具是如何被使用的。</p>

<h1 id="keystone的单元测试框架">Keystone的单元测试框架</h1>

<p>现在，我们以Keystone项目为例，来看下真实项目中的单元测试是如何架构的。我们采用自顶向下的方式，先从最上层的部分介绍起。</p>

<h2 id="使用tox进行测试环境管理">使用tox进行测试环境管理</h2>

<p>大部分情况下，我们都是通过<strong>tox</strong>命令来执行单元测试的，并且传递环境名称给tox命令：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>➜ ~/openstack/env/p/keystone git:(master) ✗ $ tox -e py27
</code></pre>
</div>

<p>tox命令首先会读取项目根目录下的<em>tox.ini</em>文件，获取相关的信息，然后根据配置构建virtualenv，保存在<em>.tox/</em>目录下，以环境名称命名：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>➜ ~/openstack/env/p/keystone git:(master) ✗ $ ls .tox
log  pep8  py27
</code></pre>
</div>

<p>除了<em>log</em>目录，其他的都是普通的virtualenv环境，你可以自己查看一下内容。我们来看下<em>py27</em>这个环境的相关配置（在tox.ini）中，我直接在内容上注释一些配置的用途：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[tox]
minversion = 1.6
skipsdist = True
# envlist表示本文件中配置的环境都有哪些
envlist = py34,py27,pep8,docs,genconfig,releasenotes

# testenv是默认配置，如果某个配置在环境专属的section中没有，就从这个section中读取
[testenv]
# usedevelop表示安装virtualenv的时候，本项目自己的代码采用开发模式安装，也就是不会拷贝代码到virtualenv目录中，只是做个链接
usedevelop = True
# install_command表示构建环境的时候要执行的命令，一般是使用pip安装
install_command = pip install -U {opts} {packages}
setenv = VIRTUAL_ENV={envdir}
# deps指定构建环境的时候需要安装的依赖包，这个就是作为pip命令的参数
# keystone这里使用的写法比较特殊一点，第二行的.[ldap,memcache,mongodb]是两个依赖，第一个点'.'表示当前项目的依赖，也就是requirements.txt，第二个部分[ldap,memcache,mongodb]表示extra，是在setup.cfg文件中定义的一个段的名称，该段下定义了额外的依赖，这些可以查看PEP0508
# 一般的项目这里会采用更简单的方式来书写，直接安装两个文件中的依赖：
#    -r{toxinidir}/requirements.txt
#    -r{toxinidir}/test-requirements.txt
deps = -r{toxinidir}/test-requirements.txt
       .[ldap,memcache,mongodb]
# commands表示构建好virtualenv之后要执行的命令，这里调用了tools/pretty_tox.sh来执行测试
commands =
  find keystone -type f -name "*.pyc" -delete
  bash tools/pretty_tox.sh '{posargs}'
whitelist_externals =
  bash
  find
passenv = http_proxy HTTP_PROXY https_proxy HTTPS_PROXY no_proxy NO_PROXY PBR_VERSION

# 这个section是为py34环境定制某些配置的，没有定制的配置，从[testenv]读取
[testenv:py34]
commands =
  find keystone -type f -name "*.pyc" -delete
  bash tools/pretty_tox_py3.sh
</code></pre>
</div>

<p>上面提到的<a href="https://www.python.org/dev/peps/pep-0508/">PEP-0508</a>是依赖格式的完整说明。setup.cfg的<em>extra</em>部分如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[extras]
ldap =
  python-ldap&gt;=2.4:python_version=='2.7' # PSF
  ldappool&gt;=1.0:python_version=='2.7' # MPL
memcache =
  python-memcached&gt;=1.56 # PSF
mongodb =
  pymongo!=3.1,&gt;=3.0.2 # Apache-2.0
bandit =
  bandit&gt;=0.17.3 # Apache-2.0
</code></pre>
</div>

<h2 id="使用testrepository管理测试的运行">使用testrepository管理测试的运行</h2>

<p>上面我们看到<em>tox.ini</em>文件中的<code class="highlighter-rouge">commands</code>参数中执行的是<em>tools/pretty_tox.sh</em>命令。这个脚本的内容如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>

<span class="nb">set</span> -o pipefail

<span class="nv">TESTRARGS</span><span class="o">=</span><span class="nv">$1</span>
<span class="c"># testr和setuptools已经集成，所以可以通过setup.py testr命令来执行</span>
<span class="c"># --testr-args表示传递给testr命令的参数，告诉testr要传递给subunit的参数</span>
<span class="c"># subunit-trace是os-testr包中的命令（os-testr是OpenStack的一个项目），用来解析subunit的输出的。</span>
python setup.py testr --testr-args<span class="o">=</span><span class="s2">"--subunit </span><span class="nv">$TESTRARGS</span><span class="s2">"</span> | subunit-trace -f
<span class="nv">retval</span><span class="o">=</span><span class="nv">$?</span>
<span class="c"># NOTE(mtreinish) The pipe above would eat the slowest display from pbr's testr</span>
<span class="c"># wrapper so just manually print the slowest tests.</span>
<span class="nb">echo</span> -e <span class="s2">"</span><span class="se">\n</span><span class="s2">Slowest Tests:</span><span class="se">\n</span><span class="s2">"</span>
<span class="c"># 测试结束后，让testr显示出执行时间最长的那些测试用例</span>
testr slowest
<span class="nb">exit</span> <span class="nv">$retval</span>
</code></pre>
</div>

<p>tox就是从<em>tools/pretty_tox.sh</em>这个命令开始调用testr来执行单元测试的。testr本身的配置是放在项目根目录下的<em>.testr.conf</em>文件：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[DEFAULT]
test_command=
    ${PYTHON:-python} -m subunit.run discover -t ./ ${OS_TEST_PATH:-./keystone/tests/unit} $LISTOPT $IDOPTION

test_id_option=--load-list $IDFILE
test_list_option=--list
group_regex=.*(test_cert_setup)


# NOTE(morganfainberg): If single-worker mode is wanted (e.g. for live tests)
# the environment variable ``TEST_RUN_CONCURRENCY`` should be set to ``1``. If
# a non-default (1 worker per available core) concurrency is desired, set
# environment variable ``TEST_RUN_CONCURRENCY`` to the desired number of
# workers.
test_run_concurrency=echo ${TEST_RUN_CONCURRENCY:-0}
</code></pre>
</div>

<p>这个文件中的配置项可以从<a href="http://testrepository.readthedocs.org/en/latest/">testr官方文档</a>中找到。其中<code class="highlighter-rouge">test_command</code>命令表示要执行什么命令来运行测试用例，这里使用的是<code class="highlighter-rouge">subunit.run</code>，这个我们在上面提到过了。</p>

<p>到目前为止的流程就是：</p>

<ol>
  <li>tox建好virtualenv</li>
  <li>tox调用testr</li>
  <li>testr调用subunit来执行测试用例</li>
</ol>

<p>每个OpenStack项目基本上也都是这样。如果你自己在开发一个Python项目，你也可以参考这个架构。</p>

<h2 id="单元测试用例的代码架构">单元测试用例的代码架构</h2>

<p>下面我们来看一下Keystone的单元测试代码是如何写的，主要是看一下其层次结构。每个OpenStack项目的单元测试代码结构可能都不一样，不过你了解完Keystone的结构之后，看其他项目的就会比较快了。</p>

<p>我们以一个测试类为例来分析测试代码的结构：<code class="highlighter-rouge">keystone.tests.unit.test_v3_assignment:AssignmentTestCase</code>。下面是这个类的继承结构，同一级别的缩进表示多重继承，增加缩进表示父类，这里删掉了不必要的路径前缀（从unit目录开始），如下所示：</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 这个测试类是测RoleAssignment的API的
unit.test_v3_assignment.RoleAssignmentBaseTestCase
-&gt; unit.test_v3.AssignmentTestMixin  这个类包含了一下测试Assignment的工具函数
-&gt; unit.test_v3.RestfulTestCase      这个类是进行V3 REST API测试的基类，实现了V3 API的请求发起和校验
  -&gt; unit.core.SQLDriverOverride     用于修改各个配置的driver字段为sql
  -&gt; unit.test_v3.AuthTestMixin      包含创建认证请求的辅助函数
  -&gt; unit.rest.RestfulTestCase       这个类是进行RESP API测试的基类，V2和V3的API测试都是以这个类为基类，这个类的setUp方法会初始化数据库，创建好TestApp。
    -&gt; unit.TestCase                 这个类是Keystone中所有单元测试类的基类，它主要初始化配置，以及初始化log
      -&gt; unit.BaseTestCase           这个类主要是配置测试运行的基本环境，修改一些环境变量，比如HOME等。
        -&gt; oslotest.BaseTestCase     这个是在oslotest中定义的基类，原来所有的OpenStack项目的单元测试都继承自这个基类。
                                     不过，这个继承在Keystone中已经被删除了，Keystone自己在unit.BaseTestCase中做了差不多的事情。
                                     这个是2016-02-17做的变更，具体的可以查看这个revision 262d0b66c3bcb82eadb663910ee21ded63e77a78。
          -&gt; testtools.TestCase      使用testtools作为测试框架
            -&gt; unittest.TestCase     testtools本身是unittest的扩展
</code></pre>
</div>

<p>从上面的层次结构可以看出，OpenStack中的大项目，由于单元测试用例很多（Keystone现在有超过6200个单元测试用例），所以其单元测试架构也会比较复杂。要写好单元测试，需要先了解一下整个测试代码的架构。</p>

<h1 id="总结">总结</h1>

<p>本文我们了解了Python中的单元测试的概念和工具，并且通过Keystone项目了解了实际项目中的单元测试的架构，希望有助于各位读者更好的掌握OpenStack项目的单元测试基础。<a href="https://github.com/diabloneo/webdemo">webdemo项目</a>目前没有单元测试的代码，有兴趣的读者可以自己fork然后参考Keystone的架构为其增加完整的单元测试架构。</p>

<h1 id="系列后记">系列后记</h1>

<p>这个系列我打算就此结束，到目前为止一共写了8篇文章，写写停停，前后写了9个月。这里也做个小结。</p>

<p>一开始写这个系列的文章是因为我自己在学习OpenStack开发的过程中遇到很多困难，很难找到所需的入门文章。所以打算写点文章，既能作为自己的总结，也能为其他人提供些帮助。如果这些文章能帮到你，我就非常的开心。当然，这些文章的质量肯定有好有坏，欢迎大家提意见，如果有时间，我会继续修改。</p>

<p>然后，我想说一下写这类文章的难点，主要是要保证细节都是正确的，然后又不能太啰嗦。</p>

<ul>
  <li><strong>细节都是正确的</strong>。举个例子，大学的很多数据结构教材中的代码，你直接贴到电脑上，然后编译，大部分是编译不通过的。这个会让初学者非常沮丧。所以我希望能够保证这些文章里的细节都是正确的，包括一些工具的配置，如果觉得有必要，我也会描述下配置的作用，以及要去哪里找更多的信息。如果这方面有遗漏，请和我说。</li>
  <li><strong>不能太啰嗦</strong>。这8篇文章里涉及的库有好几十个，每个库如果都讲仔细了，那就会让文章显得非常啰嗦。但是又不能直接让读者去看库的官方文档，所以权衡内容也是很麻烦的。如果各位有这方面的建议，也请和我说。</li>
</ul>

<p>这个系列的文章是关于OpenStack的基础知识，其实OpenStack开发还要涉及到很多其他的知识，比如消息队列、非阻塞IO等，而且还要了解整个OpenStack的开发生态，包括Gerrit评审系统、Zuul持续集成、devstack开发环境、oslo项目等。</p>


    <br />
    <div>
      <!-- aThis Button BEGIN -->
      <div class="jiathis_style_32x32">
        <a class="jiathis_button_tsina"></a>
        <a class="jiathis_button_twitter"></a>
        <a class="jiathis_button_googleplus"></a>
        <a class="jiathis_button_weixin"></a>
        <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
      </div>
      <script type="text/javascript" >
var jiathis_config={
  sm:"tsina,weixin,twitter,googleplus",
  summary:"",
  shortUrl:false,
  hideMore:true
}
      </script>
      <script type="text/javascript" src="http://v3.jiathis.com/code_mini/jia.js" charset="utf-8"></script>
      <!-- JiaThis Button END -->
    </div>
    <div>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可。
    </div>
  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Coffee, Coke and Code</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Coffee, Coke and Code</li>
          <li><a href="mailto:diabloneo@gmail.com">diabloneo@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/diabloneo"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">diabloneo</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/diabloneo"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">diabloneo</span></a>

          </li>
          

          
          <li>
            <a href="https://weibo.com/diabloneo"><span class="icon icon--weibo"><?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1506693756610" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1461" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M36.795021 82.536808 36.795021 82.536808 36.795021 82.536808Z" p-id="1462"></path><path d="M704.237279 523.521404c-9.210779-1.846044-15.190981-4.604878-17.941628-8.278547-2.749624-3.672646-3.210112-7.05058-1.384533-10.133801l2.769067-4.595668c0.607844-0.608867 1.226944-1.530866 1.855254-2.769067 0.62831-1.237177 1.855254-3.848655 3.682879-7.835456 1.826602-3.987824 3.211135-7.973602 4.1536-11.961426 0.942465-3.986801 1.708921-8.895601 2.297322-14.728446 0.589424-5.832845 0.431835-11.361769-0.470721-16.58677-0.903579-5.225001-2.749624-10.900258-5.539156-17.027815-2.790556-6.127558-6.628978-11.656481-11.519358-16.585747-8.601912-8.601912-19.806091-14.129812-33.613562-16.585747-13.807471-2.454912-27.613918-2.611477-41.421388-0.470721-13.806447 2.142803-26.847461 4.901637-39.122019 8.278547-12.274558 3.377934-22.398126 6.598278-30.372751 9.664104l-11.960403 5.538133c-6.147 1.846044-11.213389 3.074012-15.201214 3.682879-3.987824 0.60989-7.060813 0.453325-9.219989-0.470721-2.160199-0.923022-3.848655-1.846044-5.068436-2.768043-1.218758-0.923022-1.680269-3.072989-1.384533-6.451946 0.296759-3.377934 0.599657-6.294356 0.912789-8.749268 0.313132-2.452865 1.078565-6.293333 2.297322-11.519358 1.217734-5.226025 2.14178-9.369392 2.768043-12.432147 0-7.364735-0.461511-14.267958-1.384533-20.709671-0.923022-6.441713-2.916423-13.649881-5.981225-21.623483-3.063779-7.973602-7.512091-14.415314-13.345959-19.326161-5.833869-4.910846-13.198603-8.896624-22.095227-11.960403-8.896624-3.063779-20.406772-3.986801-34.527374-2.769067-14.121626 1.218758-30.079062 4.900613-47.873334 11.04659-21.485337 7.364735-43.275619 18.254759-65.369823 32.67212-22.094204 14.415314-41.273009 29.449729-57.534368 45.101197-16.261359 15.652492-31.149441 30.843472-44.661176 45.573965-13.511735 14.731516-23.950482 26.701129-31.315216 35.912931l-10.133801 14.728446c-20.249183 26.397207-35.282574 52.79339-45.102221 79.187527-9.819646 26.396183-14.424524 46.340421-13.81668 59.83476l0 19.326161c3.693112 29.458939 12.746302 55.855122 27.161616 79.187527 14.415314 23.331381 31.599695 42.205241 51.55519 56.620555 19.955494 14.415314 43.434232 26.689872 70.437236 36.82572 27.004027 10.133801 52.937676 17.498536 77.804017 22.095227 24.864294 4.595668 51.103912 7.816013 78.716806 9.664104 45.426609 3.692089 92.533486 0.166799 141.317563-10.57587 48.786123-10.744715 94.202499-29.313629 136.25322-55.708789 42.049698-26.396183 71.666226-58.006112 88.849584-94.830809 10.429537-21.48636 15.800871-41.74373 16.116049-60.776202 0.315178-19.031449-2.907213-34.527374-9.664104-46.486754-6.756891-11.960403-15.507182-22.546505-26.248827-31.758308-10.741645-9.211802-20.866237-15.968693-30.372751-20.268626-9.506515-4.299933-17.941628-7.059789-25.305339-8.278547L704.237279 523.521404 704.237279 523.521404zM423.455361 809.841455c-66.284659 3.064802-122.592083-9.829879-168.924317-38.680974-46.330188-28.851095-69.495794-65.370847-69.494771-109.561301 0-43.579541 23.01825-81.170694 69.053726-112.772436 46.036499-31.600719 102.500489-48.942689 169.394015-52.02591 66.893526-3.082198 123.358539 7.964392 169.392992 33.141818 46.036499 25.177426 69.053726 59.546188 69.053726 103.108333 0 44.190455-23.478737 83.931574-70.438259 119.224382-46.958498 35.291784-102.962 54.470589-168.009482 57.533344L423.455361 809.841455 423.455361 809.841455zM396.765489 554.806945c-17.793248 1.846044-33.750685 5.990434-47.873334 12.432147-14.121626 6.442736-25.168216 13.807471-33.140795 22.095227-7.972579 8.28878-14.728446 17.185404-20.268626 26.689872-5.539156 9.505491-9.378601 18.86465-11.519358 28.075429-2.140757 9.210779-3.524267 17.646915-4.1536 25.306362-0.630357 7.659447-0.933255 13.638625-0.913812 17.940604l0.913812 7.365758 0 3.682879c0 1.846044 0.618077 5.5279 1.855254 11.04659 1.237177 5.519714 2.925632 10.587126 5.067412 15.202237 2.14178 4.615111 5.66707 9.682523 10.57587 15.201214 4.909823 5.51869 10.743692 10.124592 17.499559 13.81668 40.517809 19.639293 78.264505 25.619494 113.243157 17.940604 34.977629-7.67889 63.209624-25.324782 84.695984-52.937676 8.601912-10.428513 14.278191-23.322172 17.028838-38.680974s2.131547-30.853705-1.855254-46.486754c-3.987824-15.634072-10.891048-29.90203-20.709671-42.805922-9.818623-12.902868-24.39255-22.880103-43.719734-29.930683-19.326161-7.05058-41.577954-9.045003-66.756403-5.981225L396.765489 554.806945 396.765489 554.806945zM363.621625 728.827327c-3.692089 0.607844-7.217379 0.765433-10.57587 0.470721-3.358491-0.293689-6.431479-0.913812-9.219989-1.855254-2.789533-0.941442-5.548366-2.01182-8.278547-3.210112-2.729158-1.197268-5.027503-2.885723-6.892991-5.067412-1.864464-2.180666-3.553942-4.331655-5.067412-6.451946-1.51347-2.12029-2.741437-4.576225-3.682879-7.364735-0.942465-2.790556-1.403976-5.705955-1.384533-8.749268 0-6.756891 1.846044-13.355169 5.538133-19.796882 3.692089-6.441713 8.759501-11.970636 15.201214-16.58677 6.441713-4.615111 13.649881-7.227612 21.624507-7.836479 5.51869-0.607844 10.890025-0.451278 16.115026 0.471744 5.225001 0.921999 9.673313 2.453888 13.345959 4.595668 3.672646 2.14178 6.894014 4.596691 9.664104 7.365758 2.77009 2.768043 4.76349 5.989411 5.981225 9.66308 1.216711 3.674693 1.835811 7.661494 1.855254 11.961426 0 6.755868-1.9934 13.19758-5.981225 19.325138-3.986801 6.128581-9.358135 11.343349-16.115026 15.643282-6.756891 4.299933-14.121626 6.755868-22.095227 7.365758L363.621625 728.827327 363.621625 728.827327zM441.86771 662.542668c-4.300956 3.063779-8.750291 4.448312-13.346983 4.1536-4.595668-0.294712-7.816013-2.288113-9.66308-5.981225l-1.856277-3.682879c-0.607844-1.237177-0.912789-2.465145-0.912789-3.682879l0-3.682879c0-1.846044 0.304945-3.377934 0.912789-4.596691l1.856277-3.682879c0.607844-1.237177 1.530866-2.160199 2.768043-2.768043l2.768043-3.682879c4.910846-3.693112 9.664104-5.225001 14.258749-4.596691 4.595668 0.629333 7.816013 3.084245 9.664104 7.365758 1.845021 2.454912 2.610454 5.214768 2.296299 8.278547-0.314155 3.063779-1.237177 5.980201-2.768043 8.749268-1.531889 2.769067-3.52529 5.380544-5.981225 7.835456L441.86771 662.542668 441.86771 662.542668zM768.695337 470.110961c3.692089 0 7.071046-0.923022 10.133801-2.769067 3.063779-1.845021 5.51869-4.143367 7.364735-6.891967 1.847068-2.750647 3.075035-5.66707 3.682879-8.749268 0.608867-0.608867 0.913812-1.531889 0.913812-2.769067 7.363711-69.976748-17.186428-109.874433-73.650417-119.695103-16.576537-3.063779-31.925107-3.367701-46.045709-0.912789-4.300956 0-7.983835 1.070378-11.04659 3.210112-3.063779 2.140757-5.676279 4.898567-7.836479 8.278547-2.160199 3.377934-3.230578 6.904247-3.210112 10.57587 0 6.147 2.15099 11.360745 6.451946 15.642259 4.300956 4.281513 9.515724 6.432503 15.643282 6.451946 47.88152-11.056823 73.658603 4.290723 77.331249 46.045709 1.237177 10.428513 0.618077 20.24816-1.855254 29.458939 0 6.148024 2.15099 11.361769 6.451946 15.643282 4.299933 4.281513 9.515724 6.432503 15.642259 6.451946L768.695337 470.110961 768.695337 470.110961zM753.052055 210.510458c-27.005051-6.147-63.22088-4.919033-108.648512 3.683902-0.607844 0-1.226944 0.303922-1.855254 0.912789l-0.912789 1.855254-0.912789 0.912789c-6.755868 1.846044-12.284791 5.685489-16.585747 11.519358-4.300956 5.833869-6.450922 12.128225-6.450922 18.883069 0 9.210779 3.072989 16.880459 9.219989 23.008017 6.147 6.128581 13.511735 9.201569 22.095227 9.219989l2.768043 0c0.608867 0 1.9934-0.303922 4.154623-0.912789 2.160199-0.607844 4.457522-1.070378 6.891967-1.384533 2.435469-0.314155 5.046946-0.932232 7.836479-1.855254 2.788509-0.923022 5.244444-1.846044 7.365758-2.769067 2.12029-0.921999 6.264681-1.384533 12.432147-1.384533 6.167466 0 13.688767 0.462534 22.565948 1.384533 8.877181 0.923022 18.697851 3.221368 29.459962 6.892991 10.763135 3.672646 21.505803 8.278547 32.229029 13.81668 10.723226 5.53711 21.465894 13.20679 32.229029 23.008017 10.763135 9.800203 20.122293 21.152762 28.075429 34.054607 15.96767 36.21583 19.041682 71.204715 9.219989 104.965633 0 0.608867-0.156566 1.227967-0.470721 1.856277-0.314155 0.62831-0.774643 2.160199-1.38351 4.595668-0.608867 2.435469-1.227967 4.732791-1.855254 6.892991-0.629333 2.160199-1.24741 4.919033-1.856277 8.278547-0.608867 3.358491-0.912789 6.274914-0.912789 8.749268 0 5.51869 1.531889 10.123568 4.596691 13.815657 3.063779 3.692089 6.904247 6.304589 11.519358 7.836479 4.615111 1.531889 9.987468 2.297322 16.115026 2.296299 17.185404 0 27.309996-10.438747 30.372751-31.31624 7.364735-23.940249 11.509125-46.801932 12.432147-68.581981 0.924045-21.782096-0.607844-40.958854-4.595668-57.534368-3.987824-16.575514-9.968026-32.072463-17.941628-46.487777-7.972579-14.415314-17.184381-26.690896-27.633361-36.823674-10.447956-10.133801-22.11467-19.34458-34.998095-27.633361-12.883425-8.287757-25.315572-14.887059-37.296441-19.796882-11.979846-4.909823-24.411993-8.896624-37.295418-11.960403L753.052055 210.508411 753.052055 210.510458z" p-id="1463"></path></svg></span><span class="username">diabloneo</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Archive diabloneo's articles.
</p>
      </div>
    </div>

  </div>

</footer>

    
      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78067453-1', 'auto');
  ga('send', 'pageview');

</script>

    
  </body>

</html>
