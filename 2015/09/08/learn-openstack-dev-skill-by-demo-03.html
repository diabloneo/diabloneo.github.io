<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>通过demo学习OpenStack开发所需的基础知识 -- API服务(2)</title>
  <meta name="description" content="本文会重点讲解OpenStack中使用的API开发框架的使用。但是本文的目的并不是覆盖这些框架的使用细节，而是通过说明重要的部分，降低初学者的入门的门槛。框架的使用细节都可以从文档中找到。说明一下，除非特殊说明，本文中的相对路径都是相对于项目源码目录的相对路径。">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="/2015/09/08/learn-openstack-dev-skill-by-demo-03.html">
  <link rel="alternate" type="application/rss+xml" title="Coffee, Coke and Code" href="/feed.xml">
</head>


  <body>
    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Coffee, Coke and Code</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">通过demo学习OpenStack开发所需的基础知识 -- API服务(2)</h1>
    <p class="post-meta"><time datetime="2015-09-08T00:00:00+08:00" itemprop="datePublished">Sep 8, 2015</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>本文会重点讲解OpenStack中使用的API开发框架的使用。但是本文的目的并不是覆盖这些框架的使用细节，而是通过说明重要的部分，降低初学者的入门的门槛。框架的使用细节都可以从文档中找到。<strong>说明一下，除非特殊说明，本文中的相对路径都是相对于项目源码目录的相对路径</strong>。</p>

<h1 id="paste--pastedeploy--routes--webob">Paste + PasteDeploy + Routes + WebOb</h1>

<p>我们在<strong>API服务(1)</strong>中已经提到了，这个框架只在早期开始的项目中使用，新的项目都已经转到Pecan框架了。但是，早期的项目都是比较核心的项目，因此我们还是要学会如何使用这个框架。我们会以Keystone项目为例，来说明如何阅读使用这个框架的开发的API代码。</p>

<h2 id="重点在于确定url路由">重点在于确定URL路由</h2>

<p>RESTful API程序的主要特点就是URL path会和功能对应起来。这点从API文档就可以看得出来，比如用户管理的功能一般都放在<em>/user</em>这个路径下。因此，看一个RESTful API程序，一般都是看它实现了哪些URL path，以及每个path对应了什么功能，这个一般都是由框架的URL路由功能负责的。所以，熟悉一个RESTful API程序的<strong>重点在于确定URL路由</strong>。本章所说的这个框架对于初学者的难点也是如何确定URL路由。</p>

<h2 id="wsgi入口和中间件">WSGI入口和中间件</h2>

<p>作为基础知识，你需要先了解一下WSGI的相关概念，可以参考这篇文章<a href="http://segmentfault.com/a/1190000003069785">WSGI简介</a>。</p>

<h3 id="wsgi入口">WSGI入口</h3>

<p>在<strong>API服务(1)</strong>中提到了WSGI可以使用Apache进行部署，也可以使用eventlet进行部署。Keystone项目同时提供了这两种方案的代码，也就是我们要找的WSGI的入口。</p>

<p>Keystone项目在<em>httpd/</em>目录下，存放了可以用于Apache服务器部署WSGI服务的文件。其中，<em>wsgi-keystone.conf</em>是一个mod_wsgi的示例配置文件，<em>keystone.py</em>则是WSGI应用程序的入口文件。<em>httpd/keystone.py</em>也就是我们要找的入口文件之一。这个文件的内容很简单：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">keystone.server</span> <span class="kn">import</span> <span class="n">wsgi</span> <span class="k">as</span> <span class="n">wsgi_server</span>

<span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">wsgi_server</span><span class="o">.</span><span class="n">initialize_application</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code></pre></figure>

<p>文件中创建了WSGI入口需要使用的<code class="highlighter-rouge">application</code>对象。</p>

<p><strong>keystone-all</strong>命令则是采用eventlet来进行部署时的入口，可以从<em>setup.cfg</em>文件按中确定keystone-all命令的入口：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[entry_points]
console_scripts =
    keystone-all = keystone.cmd.all:main
    keystone-manage = keystone.cmd.manage:main
</code></pre>
</div>

<p>从<em>setup.cfg</em>文件的entry_points部分可以看出，keystone-all的入口是<em>keystone/cmd/all.py</em>文件中的<code class="highlighter-rouge">main()</code>函数，这个函数的内容也很简单：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">eventlet_server</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">possible_topdir</span><span class="p">)</span></code></pre></figure>

<p><code class="highlighter-rouge">main()</code>函数的主要作用就是启动一个eventlet_server，配置文件从<code class="highlighter-rouge">possible_topdir</code>中查找。因为eventlet的部署方式涉及到eventlet库的使用方法，本文不再展开说明。读者可以在学会确定URL路由后再回来看这个代码。下面，继续以<em>httpd/keystone.py</em>文件作为入口来说明如何阅读代码。</p>

<h3 id="paste和pastedeploy">Paste和PasteDeploy</h3>

<p><em>httpd/keystone.py</em>中调用的<code class="highlighter-rouge">initialize_application(name)</code>函数载入了整个WSGI应用，这里主要用到了Paste和PasteDeploy库。</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">initialize_application</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">loadapp</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">keystone_service</span><span class="o">.</span><span class="n">loadapp</span><span class="p">(</span>
            <span class="s">'config:</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">find_paste_config</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>

    <span class="n">_unused</span><span class="p">,</span> <span class="n">application</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">setup_backends</span><span class="p">(</span>
        <span class="n">startup_application_fn</span><span class="o">=</span><span class="n">loadapp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">application</span></code></pre></figure>

<p>上面是删掉无关代码后的<code class="highlighter-rouge">initialize_application()</code>函数。<code class="highlighter-rouge">config.find_paste_config()</code>用来查找PasteDeploy需要用到的WSGI配置文件，这个文件在源码中是<em>etc/keystone-paste.ini</em>文件，如果在线上环境中，一般是<em>/etc/keystone-paste.init</em>。<code class="highlighter-rouge">keystone_service.loadapp()</code>函数内部则调用了<code class="highlighter-rouge">paste.deploy.loadapp()</code>函数来加载WSGI应用，如何加载则使用了刚才提到的<em>keystone-paste.ini</em>文件，这个文件也是看懂整个程序的关键。</p>

<h4 id="name很关键">name很关键</h4>

<p>在上面的代码中我们可以看到，<code class="highlighter-rouge">name</code>这个变量从<em>httpd/keystone.py</em>文件传递到<code class="highlighter-rouge">initialize_application()</code>函数，又被传递到<code class="highlighter-rouge">keystone_service.loadapp()</code>函数，最终被传递到<code class="highlighter-rouge">paste.deploy.loadapp()</code>函数。那么，<strong>这个<code class="highlighter-rouge">name</code>变量到底起什么作用呢</strong>？先把这个问题放在一边，我们后面再来解决它。</p>

<h4 id="pasteini">paste.ini</h4>

<p>使用Paste和PasteDeploy模块来实现WSGI服务时，都需要一个<strong>paste.ini</strong>文件。这个文件也是Paste框架的精髓，这里需要重点说明一下这个文件如何阅读。</p>

<p>paste.ini文件的格式类似于INI格式，每个section的格式为<strong>[type:name]</strong>。这里重要的是理解几种不同type的section的作用。</p>

<ul>
  <li><strong>composite</strong>: 这种section用于将HTTP请求分发到指定的app。</li>
  <li><strong>app</strong>: 这种section表示具体的app。</li>
  <li><strong>filter</strong>: 实现一个过滤器中间件。</li>
  <li><strong>pipeline</strong>: 用来把把一系列的filter串起来。</li>
</ul>

<p>上面这些section是在keystone的paste.ini中用到的，下面详细介绍一下如何使用。这里需要用到WSGIMiddleware(WSGI中间件)的知识，可以在<a href="http://segmentfault.com/a/1190000003069785">WSGI简介</a>这篇文章中找到。</p>

<p><strong>section composite</strong></p>

<p>这种section用来决定如何分发HTTP请求。Keystone的paste.ini文件中有两个composite的section：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[composite:main]
use = egg:Paste#urlmap
/v2.0 = public_api
/v3 = api_v3
/ = public_version_api

[composite:admin]
use = egg:Paste#urlmap
/v2.0 = admin_api
/v3 = api_v3
/ = admin_version_api
</code></pre>
</div>

<p>在composite seciont中，<strong>use</strong>是一个关键字，指定处理请求的代码。<code class="highlighter-rouge">egg:Paste#urlmap</code>表示到Paste模块的egg-info中去查找urlmap关键字所对应的函数。在virtualenv环境下，是文件<em>/lib/python2.7/site-packages/Paste-2.0.2.dist-info/metadata.json</em>：</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="err">...</span><span class="w">
    </span><span class="nt">"extensions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">...</span><span class="w">
        </span><span class="nt">"python.exports"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"paste.composite_factory"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"cascade"</span><span class="p">:</span><span class="w"> </span><span class="s2">"paste.cascade:make_cascade"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"urlmap"</span><span class="p">:</span><span class="w"> </span><span class="s2">"paste.urlmap:urlmap_factory"</span><span class="w">
            </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>
</div>

<p>在这个文件中，你可以找到<code class="highlighter-rouge">urlmap</code>对应的是<code class="highlighter-rouge">paste.urlmap:urlmap_factory</code>，也就是<em>paste/urlmap.py</em>文件中的<code class="highlighter-rouge">urlmap_factory()</code>函数。</p>

<p>composite section中其他的关键字则是<code class="highlighter-rouge">urlmap_factory()</code>函数的参数，用于表示不同的URL path前缀。<code class="highlighter-rouge">urlmap_factory()</code>函数会返回一个WSGI app，其功能是根据不同的URL path前缀，把请求路由给不同的app。以<em>[composite:main]</em>为例：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[composite:main]
use = egg:Paste#urlmap
/v2.0 = public_api       # /v2.0　开头的请求会路由给public_api处理
/v3 = api_v3             # /v3　开头的请求会路由个api_v3处理
/ = public_version_api   # / 开头的请求会路由给public_version_api处理
</code></pre>
</div>

<p>路由的对象其实就是paste.ini中其他secion的名字，类型必须是app或者pipeline。</p>

<p><strong>section pipeline</strong></p>

<p>pipeline是把filter和app串起来的一种section。它只有一个关键字就是<strong>pipeline</strong>。我们以<em>api_v3</em>这个pipeline为例：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[pipeline:api_v3]
# The last item in this pipeline must be service_v3 or an equivalent
# application. It cannot be a filter.
pipeline = sizelimit url_normalize request_id build_auth_context token_auth admin_token_auth json_body ec2_extension_v3 s3_extension simple_cert_extension revoke_extension federation_extension oauth1_extension endpoint_filter_extension endpoint_policy_extension service_v3
</code></pre>
</div>

<p>pipeline关键字指定了很多个名字，这些名字也是paste.ini文件中其他section的名字。请求会从最前面的section开始处理，一直向后传递。pipeline指定的section有如下要求：</p>

<ul>
  <li>最后一个名字对应的section一定要是一个app</li>
  <li>非最后一个名字对应的section一定要是一个filter</li>
</ul>

<p><strong>section filter</strong></p>

<p>filter是用来过滤请求和响应的，以WSGI中间件的方式实现。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[filter:sizelimit]
paste.filter_factory = oslo_middleware.sizelimit:RequestBodySizeLimiter.factory
</code></pre>
</div>

<p>这个是<em>api_v3</em>这个pipeline指定的第一个filter，作用是限制请求的大小。其中的paste.filter_factory表示调用哪个函数来获得这个filter中间件。</p>

<p><strong>section app</strong></p>

<p>app表示实现主要功能的应用，是一个标准的WSGI application。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[app:service_v3]
paste.app_factory = keystone.service:v3_app_factory
</code></pre>
</div>

<p>paste.app_factory表示调用哪个函数来获得这个app。</p>

<p><strong>总结一下</strong></p>

<p>paste.ini中这一大堆配置的作用就是把我们用Python写的WSGI application和middleware串起来，规定好HTTP请求处理的路径。</p>

<p><strong>name是用来确定入口的</strong></p>

<p>上面我们提到了一个问题，就是<code class="highlighter-rouge">name</code>变量的作用到底是什么？<code class="highlighter-rouge">name</code>变量表示paste.ini中一个section的名字，指定这个section作为HTTP请求处理的第一站。在Keystone的paste.ini中，请求必须先由[composite:main]或者[composite:admin]处理，所以在keystone项目中，<code class="highlighter-rouge">name</code>的值必须是<em>main</em>或者<em>admin</em>。</p>

<p>上面提到的<em>httpd/keystone.py</em>文件中，name等于文件名的basename，所以实际部署中，必须把<em>keystone.py</em>重命名为<em>main.py</em>或者<em>admin.py</em>。</p>

<p><strong>举个例子</strong></p>

<p>一般情况下，从Keystone服务获取一个token时，会使用下面这个API：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>POST http://hostname:35357/v3/auth/tokens
</code></pre>
</div>

<p>我们根据Keystone的paste.ini来说明这个API是如何被处理的：</p>

<ol>
  <li>hostname:35357 这一部分是由Web服务器处理的，比如Apache。然后，请求会被转到WSGI的入口，也就是<em>httpd/keystone.py</em>中的<code class="highlighter-rouge">application</code>对象取处理。</li>
  <li><code class="highlighter-rouge">application</code>对象是根据paste.ini中的配置来处理的。这里会先由[composite:admin]来处理（一般是admin监听35357端口，main监听5000端口）。</li>
  <li>[composite:admin]发现请求的path是<em>/v3</em>开头的，于是就把请求转发给[pipeline:api_v3]去处理，转发之前，会把<em>/v3</em>这个部分去掉。</li>
  <li>[pipeline:api_v3]收到请求，path是/auth/tokens，然后开始调用各个filter来处理请求。最后会把请求交给[app:service_v3]进行处理。</li>
  <li>[app:service_v3]收到请求，path是/auth/tokens，然后交给最终的WSGI app去处理。</li>
</ol>

<p><strong>下一步</strong></p>

<p>到此为止，paste.ini中的配置的所有工作都已经做完了。下面请求就要转移到最终的app内部去处理了。前面已经说过了，我们的重点是确定URL路由，那么现在还有一部分的path的路由还没确定，/auth/tokens，这个还需要下一步的工作。</p>

<h2 id="中间件的实现">中间件的实现</h2>

<p>上面我们提到paste.ini中用到了许多的WSGI中间件，那么这些中间件是如何实现的呢？我们来看一个例子就知道了。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[filter:build_auth_context]
paste.filter_factory = keystone.middleware:AuthContextMiddleware.factory
</code></pre>
</div>

<p>build_auth_context这个中间件的作用是在WSGI的environ中添加<em>KEYSTONE_AUTH_CONTEXT</em>这个键，包含的内容是认证信息的上下文。实现这个中间件的类继承关系如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>keystone.middleware.core.AuthContextMiddleware
  -&gt; keystone.common.wsgi.Middleware
    -&gt; keystone.common.wsgi.Application
      -&gt; keystone.common.wsgi.BaseApplication
</code></pre>
</div>

<p>这里实现的关键主要在前面两个类中。</p>

<p><em>keystone.common.wsgi.Middleware</em>类实现了<code class="highlighter-rouge">__call__()</code>方法，这个就是WSGI中application端被调用时运行的方法。</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Middleware</span><span class="p">(</span><span class="n">Application</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="nd">@webob.dec.wsgify</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">application</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">exceptin</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="o">...</span>
        <span class="o">...</span></code></pre></figure>

<p><strong>__call__()</strong>方法实现为接收一个request对象，返回一个response对象的形式，然后使用WebOB模块的装饰器<code class="highlighter-rouge">webob.dec.wsgify()</code>将它变成标准的WSGI application接口。这里的request和response对象分别是 <code class="highlighter-rouge">webob.Request</code> 和<code class="highlighter-rouge">webob.Response</code>。这里，<code class="highlighter-rouge">__call__()</code>方法内部调用了<code class="highlighter-rouge">self.process_request()</code>方法，这个方法在<em>keystone.middleware.core.AuthContextMiddleware</em>中实现：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">AuthContextMiddleware</span><span class="p">(</span><span class="n">wsgi</span><span class="o">.</span><span class="n">Middleware</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">authorization</span><span class="o">.</span><span class="n">AUTH_CONTEXT_ENV</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth_context</span></code></pre></figure>

<p>这个函数会根据功能设计创建<code class="highlighter-rouge">auth_context</code>，然后赋值给<code class="highlighter-rouge">request.environ['KEYSTONE_AUTH_CONTEXT</code>]`，这样就能通过WSGI application方法的environ传递到下一个WSGI application中去了。</p>

<h2 id="最后的application">最后的Application</h2>

<p>上面我们已经看到了，对于/v3开头的请求，在paste.ini中会被路由到[app:service_v3]这个section，会交给<code class="highlighter-rouge">keystone.service:v3_app_factory</code>这个函数生成的application处理。最后这个application需要根据URL path中剩下的部分，<strong>/auth/tokens</strong>，来实现URL路由。从这里开始，就需要用到<strong>Routes</strong>模块了。</p>

<p>同样由于篇幅限制，我们只能展示Routes模块的大概用法。Routes模块是用Python实现的类似Rails的URL路由系统，它的主要功能就是把path映射到对应的动作。</p>

<p>Routes模块的一般用法是创建一个<code class="highlighter-rouge">Mapper</code>对象，然后调用该对象的<code class="highlighter-rouge">connect()</code>方法把path和method映射到一个controller的某个action上，这里controller是一个自定义的类实例，action是表示controller对象的方法的字符串。一般调用的时候还会指定映射哪些方法，比如GET或者POST之类的。</p>

<p>举个例子，来看下<em>keystone/auth/routers.py</em>的代码：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Routers</span><span class="p">(</span><span class="n">wsgi</span><span class="o">.</span><span class="n">RoutersBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">append_v3_routers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">routers</span><span class="p">):</span>
        <span class="n">auth_controller</span> <span class="o">=</span> <span class="n">controllers</span><span class="o">.</span><span class="n">Auth</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_add_resource</span><span class="p">(</span>
            <span class="n">mapper</span><span class="p">,</span> <span class="n">auth_controller</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="s">'/auth/tokens'</span><span class="p">,</span>
            <span class="n">get_action</span><span class="o">=</span><span class="s">'validate_token'</span><span class="p">,</span>
            <span class="n">head_action</span><span class="o">=</span><span class="s">'check_token'</span><span class="p">,</span>
            <span class="n">post_action</span><span class="o">=</span><span class="s">'authenticate_for_token'</span><span class="p">,</span>
            <span class="n">delete_action</span><span class="o">=</span><span class="s">'revoke_token'</span><span class="p">,</span>
            <span class="n">rel</span><span class="o">=</span><span class="n">json_home</span><span class="o">.</span><span class="n">build_v3_resource_relation</span><span class="p">(</span><span class="s">'auth_tokens'</span><span class="p">))</span>

    <span class="o">...</span></code></pre></figure>

<p>这里调用了自己Keystone自己封装的<em>_add_resource()</em>方法批量为一个<em>/auth/tokens</em>这个path添加多个方法的处理函数。其中，controller是一个<em>controllers.Auth</em>实例，也就是 <em>keystone.auth.controllers.Auth</em>。其他的参数，我们从名称可以猜出其作用是指定对应方法的处理函数，比如get_action用于指定<strong>GET</strong>方法的处理函数为<em>validate_token</em>。我们再深入一下，看下<em>_add_resource()</em>这个方法的实现：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">    <span class="k">def</span> <span class="nf">_add_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapper</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span>
                      <span class="n">get_action</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">head_action</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">get_head_action</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">put_action</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">post_action</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">patch_action</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">delete_action</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">get_post_action</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">path_vars</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">json_home</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">STABLE</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">if</span> <span class="n">get_action</span><span class="p">:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">get_action</span><span class="p">)</span>  <span class="c"># ensure the attribute exists</span>
            <span class="n">mapper</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">controller</span><span class="o">=</span><span class="n">controller</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">get_action</span><span class="p">,</span>
                           <span class="n">conditions</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">]))</span>
        <span class="o">...</span></code></pre></figure>

<p>这个函数其实很简单，就是调用mapper对象的<em>connect</em>方法指定一个path的某些method的处理函数。</p>

<h3 id="keystone项目的代码结构">Keystone项目的代码结构</h3>

<p>Keystone项目把每个功能都分到单独的目录下，比如token相关的功能是放在<em>keystone/token/</em>目录下，assignment相关的功能是放在<em>keystone/assignment/</em>目录下。目录下都一般会有三个文件：<em>routers.py</em>, <em>controllers.py</em>, <em>core.py</em>。<em>routers.py</em>中实现了URL路由，把URL和<em>controllers.py</em>中的action对应起来；<em>controllers.py</em>中的action调用<em>core.py</em>中的底层接口实现RESTful API承诺的功能。所以，我们要进一步确定URL路由是如何做的，就要看<em>routers.py</em>文件。</p>

<p>注意，这个只是Keystone项目的结构，其他项目即使用了同样的框架，也不一定是这么做的。</p>

<h3 id="keystone中的路由汇总">Keystone中的路由汇总</h3>

<p>每个模块都定义了自己的路由，但是这些路由最终要还是要通过一个WSGI application来调用的。上面已经提到了，在Keystone中，/v3开头的请求最终都会交给<code class="highlighter-rouge">keystone.service.v3_app_factory</code>这个函数生成的application来处理。这个函数里也包含了路由最后分发的秘密，我们来看代码：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">v3_app_factory</span><span class="p">(</span><span class="n">global_conf</span><span class="p">,</span> <span class="o">**</span><span class="n">local_conf</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">mapper</span> <span class="o">=</span> <span class="n">routes</span><span class="o">.</span><span class="n">Mapper</span><span class="p">()</span>
    <span class="o">...</span>
    
    <span class="n">router_modules</span> <span class="o">=</span> <span class="p">[</span><span class="n">auth</span><span class="p">,</span>
                      <span class="n">assignment</span><span class="p">,</span>
                      <span class="n">catalog</span><span class="p">,</span>
                      <span class="n">credential</span><span class="p">,</span>
                      <span class="n">identity</span><span class="p">,</span>
                      <span class="n">policy</span><span class="p">,</span>
                      <span class="n">resource</span><span class="p">]</span>
    <span class="o">...</span>

    <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">router_modules</span><span class="p">:</span>
        <span class="n">routers_instance</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">routers</span><span class="o">.</span><span class="n">Routers</span><span class="p">()</span>
        <span class="n">_routers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">routers_instance</span><span class="p">)</span>
        <span class="n">routers_instance</span><span class="o">.</span><span class="n">append_v3_routers</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">sub_routers</span><span class="p">)</span>

    <span class="c"># Add in the v3 version api</span>
    <span class="n">sub_routers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">routers</span><span class="o">.</span><span class="n">VersionV3</span><span class="p">(</span><span class="s">'public'</span><span class="p">,</span> <span class="n">_routers</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">wsgi</span><span class="o">.</span><span class="n">ComposingRouter</span><span class="p">(</span><span class="n">mapper</span><span class="p">,</span> <span class="n">sub_routers</span><span class="p">)</span></code></pre></figure>

<p><code class="highlighter-rouge">v3_app_factory()</code>函数中先遍历了所有的模块，将每个模块的路由都添加到同一个mapper对象中，然后把mapper对象作为参数用于初始化<em>wsgi.ComposingRouter</em>对象，所以我们可以判断，这个<em>wsgi.ComposingRouter</em>对象一定是一个WSGI application，我们看看代码就知道了：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">Router</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s">"""WSGI middleware that maps incoming requests to WSGI apps."""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapper</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="nb">map</span> <span class="o">=</span> <span class="n">mapper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_router</span> <span class="o">=</span> <span class="n">routes</span><span class="o">.</span><span class="n">middleware</span><span class="o">.</span><span class="n">RoutesMiddleware</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="nb">map</span><span class="p">)</span>

    <span class="nd">@webob.dec.wsgify</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_router</span>

    <span class="o">...</span>
    
<span class="k">class</span> <span class="nc">ComposingRouter</span><span class="p">(</span><span class="n">Router</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mapper</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">routers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="o">...</span></code></pre></figure>

<p>上述代码证实了我们的猜测。这个ComposingRouter对象被调用时（在其父类Router中实现），会返回一个WSGI application。这个application中则使用了routes模块的中间件来实现了请求路由，在<em>routes.middleware.RoutesMiddleware</em>中实现。这里对path进行路由的结果就是返回各个模块的<em>controllers.py</em>中定义的controller。各个模块的controller都是一个WSGI application，这个你可以通过这些controller的类继承关系看出来。</p>

<p>但是这里只讲到了，routes模块把path映射到了一个controller，但是如何把对path的处理映射到controller的方法呢？这个可以从controller的父类<em>keystone.common.wsgi.Application</em>的实现看出来。这个Application类中使用了<code class="highlighter-rouge">environ['wsgiorg.routing_args']</code>中的数据来确定调用controller的哪个方法，这些数据是由上面提到的<em>routes.middleware.RoutesMiddleware</em>设置的。</p>

<h2 id="总结">总结</h2>

<p>到这里我们大概把<strong>Paste + PasteDeploy + Routes + WebOb</strong>这个框架的流程讲了一遍，从本文的长度你就可以看出这个框架有多啰嗦，用起来有多麻烦。下一篇文章我们会讲Pecan框架，我们的demo也将会使用Pecan框架来开发。</p>

<h2 id="参考资源">参考资源</h2>

<p>本文主要提到了Python Paste中的各种库，这些库的相关文档都可以在项目官网找到:<a href="http://pythonpaste.org/">http://pythonpaste.org/</a>。</p>

<p>另外，routes库的项目官网是：<a href="https://routes.readthedocs.org/en/latest/">https://routes.readthedocs.org/en/latest/</a></p>


    <br />
    <div>
      <!-- aThis Button BEGIN -->
      <div class="jiathis_style_32x32">
        <a class="jiathis_button_tsina"></a>
        <a class="jiathis_button_twitter"></a>
        <a class="jiathis_button_googleplus"></a>
        <a class="jiathis_button_weixin"></a>
        <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
      </div>
      <script type="text/javascript" >
var jiathis_config={
  sm:"tsina,weixin,twitter,googleplus",
  summary:"",
  shortUrl:false,
  hideMore:true
}
      </script>
      <script type="text/javascript" src="http://v3.jiathis.com/code_mini/jia.js" charset="utf-8"></script>
      <!-- JiaThis Button END -->
    </div>
    <div>
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可。
    </div>
  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Coffee, Coke and Code</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>Coffee, Coke and Code</li>
          <li><a href="mailto:diabloneo@gmail.com">diabloneo@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/diabloneo"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">diabloneo</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/diabloneo"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">diabloneo</span></a>

          </li>
          

          
          <li>
            <a href="https://weibo.com/diabloneo"><span class="icon icon--weibo"><?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1506693756610" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1461" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M36.795021 82.536808 36.795021 82.536808 36.795021 82.536808Z" p-id="1462"></path><path d="M704.237279 523.521404c-9.210779-1.846044-15.190981-4.604878-17.941628-8.278547-2.749624-3.672646-3.210112-7.05058-1.384533-10.133801l2.769067-4.595668c0.607844-0.608867 1.226944-1.530866 1.855254-2.769067 0.62831-1.237177 1.855254-3.848655 3.682879-7.835456 1.826602-3.987824 3.211135-7.973602 4.1536-11.961426 0.942465-3.986801 1.708921-8.895601 2.297322-14.728446 0.589424-5.832845 0.431835-11.361769-0.470721-16.58677-0.903579-5.225001-2.749624-10.900258-5.539156-17.027815-2.790556-6.127558-6.628978-11.656481-11.519358-16.585747-8.601912-8.601912-19.806091-14.129812-33.613562-16.585747-13.807471-2.454912-27.613918-2.611477-41.421388-0.470721-13.806447 2.142803-26.847461 4.901637-39.122019 8.278547-12.274558 3.377934-22.398126 6.598278-30.372751 9.664104l-11.960403 5.538133c-6.147 1.846044-11.213389 3.074012-15.201214 3.682879-3.987824 0.60989-7.060813 0.453325-9.219989-0.470721-2.160199-0.923022-3.848655-1.846044-5.068436-2.768043-1.218758-0.923022-1.680269-3.072989-1.384533-6.451946 0.296759-3.377934 0.599657-6.294356 0.912789-8.749268 0.313132-2.452865 1.078565-6.293333 2.297322-11.519358 1.217734-5.226025 2.14178-9.369392 2.768043-12.432147 0-7.364735-0.461511-14.267958-1.384533-20.709671-0.923022-6.441713-2.916423-13.649881-5.981225-21.623483-3.063779-7.973602-7.512091-14.415314-13.345959-19.326161-5.833869-4.910846-13.198603-8.896624-22.095227-11.960403-8.896624-3.063779-20.406772-3.986801-34.527374-2.769067-14.121626 1.218758-30.079062 4.900613-47.873334 11.04659-21.485337 7.364735-43.275619 18.254759-65.369823 32.67212-22.094204 14.415314-41.273009 29.449729-57.534368 45.101197-16.261359 15.652492-31.149441 30.843472-44.661176 45.573965-13.511735 14.731516-23.950482 26.701129-31.315216 35.912931l-10.133801 14.728446c-20.249183 26.397207-35.282574 52.79339-45.102221 79.187527-9.819646 26.396183-14.424524 46.340421-13.81668 59.83476l0 19.326161c3.693112 29.458939 12.746302 55.855122 27.161616 79.187527 14.415314 23.331381 31.599695 42.205241 51.55519 56.620555 19.955494 14.415314 43.434232 26.689872 70.437236 36.82572 27.004027 10.133801 52.937676 17.498536 77.804017 22.095227 24.864294 4.595668 51.103912 7.816013 78.716806 9.664104 45.426609 3.692089 92.533486 0.166799 141.317563-10.57587 48.786123-10.744715 94.202499-29.313629 136.25322-55.708789 42.049698-26.396183 71.666226-58.006112 88.849584-94.830809 10.429537-21.48636 15.800871-41.74373 16.116049-60.776202 0.315178-19.031449-2.907213-34.527374-9.664104-46.486754-6.756891-11.960403-15.507182-22.546505-26.248827-31.758308-10.741645-9.211802-20.866237-15.968693-30.372751-20.268626-9.506515-4.299933-17.941628-7.059789-25.305339-8.278547L704.237279 523.521404 704.237279 523.521404zM423.455361 809.841455c-66.284659 3.064802-122.592083-9.829879-168.924317-38.680974-46.330188-28.851095-69.495794-65.370847-69.494771-109.561301 0-43.579541 23.01825-81.170694 69.053726-112.772436 46.036499-31.600719 102.500489-48.942689 169.394015-52.02591 66.893526-3.082198 123.358539 7.964392 169.392992 33.141818 46.036499 25.177426 69.053726 59.546188 69.053726 103.108333 0 44.190455-23.478737 83.931574-70.438259 119.224382-46.958498 35.291784-102.962 54.470589-168.009482 57.533344L423.455361 809.841455 423.455361 809.841455zM396.765489 554.806945c-17.793248 1.846044-33.750685 5.990434-47.873334 12.432147-14.121626 6.442736-25.168216 13.807471-33.140795 22.095227-7.972579 8.28878-14.728446 17.185404-20.268626 26.689872-5.539156 9.505491-9.378601 18.86465-11.519358 28.075429-2.140757 9.210779-3.524267 17.646915-4.1536 25.306362-0.630357 7.659447-0.933255 13.638625-0.913812 17.940604l0.913812 7.365758 0 3.682879c0 1.846044 0.618077 5.5279 1.855254 11.04659 1.237177 5.519714 2.925632 10.587126 5.067412 15.202237 2.14178 4.615111 5.66707 9.682523 10.57587 15.201214 4.909823 5.51869 10.743692 10.124592 17.499559 13.81668 40.517809 19.639293 78.264505 25.619494 113.243157 17.940604 34.977629-7.67889 63.209624-25.324782 84.695984-52.937676 8.601912-10.428513 14.278191-23.322172 17.028838-38.680974s2.131547-30.853705-1.855254-46.486754c-3.987824-15.634072-10.891048-29.90203-20.709671-42.805922-9.818623-12.902868-24.39255-22.880103-43.719734-29.930683-19.326161-7.05058-41.577954-9.045003-66.756403-5.981225L396.765489 554.806945 396.765489 554.806945zM363.621625 728.827327c-3.692089 0.607844-7.217379 0.765433-10.57587 0.470721-3.358491-0.293689-6.431479-0.913812-9.219989-1.855254-2.789533-0.941442-5.548366-2.01182-8.278547-3.210112-2.729158-1.197268-5.027503-2.885723-6.892991-5.067412-1.864464-2.180666-3.553942-4.331655-5.067412-6.451946-1.51347-2.12029-2.741437-4.576225-3.682879-7.364735-0.942465-2.790556-1.403976-5.705955-1.384533-8.749268 0-6.756891 1.846044-13.355169 5.538133-19.796882 3.692089-6.441713 8.759501-11.970636 15.201214-16.58677 6.441713-4.615111 13.649881-7.227612 21.624507-7.836479 5.51869-0.607844 10.890025-0.451278 16.115026 0.471744 5.225001 0.921999 9.673313 2.453888 13.345959 4.595668 3.672646 2.14178 6.894014 4.596691 9.664104 7.365758 2.77009 2.768043 4.76349 5.989411 5.981225 9.66308 1.216711 3.674693 1.835811 7.661494 1.855254 11.961426 0 6.755868-1.9934 13.19758-5.981225 19.325138-3.986801 6.128581-9.358135 11.343349-16.115026 15.643282-6.756891 4.299933-14.121626 6.755868-22.095227 7.365758L363.621625 728.827327 363.621625 728.827327zM441.86771 662.542668c-4.300956 3.063779-8.750291 4.448312-13.346983 4.1536-4.595668-0.294712-7.816013-2.288113-9.66308-5.981225l-1.856277-3.682879c-0.607844-1.237177-0.912789-2.465145-0.912789-3.682879l0-3.682879c0-1.846044 0.304945-3.377934 0.912789-4.596691l1.856277-3.682879c0.607844-1.237177 1.530866-2.160199 2.768043-2.768043l2.768043-3.682879c4.910846-3.693112 9.664104-5.225001 14.258749-4.596691 4.595668 0.629333 7.816013 3.084245 9.664104 7.365758 1.845021 2.454912 2.610454 5.214768 2.296299 8.278547-0.314155 3.063779-1.237177 5.980201-2.768043 8.749268-1.531889 2.769067-3.52529 5.380544-5.981225 7.835456L441.86771 662.542668 441.86771 662.542668zM768.695337 470.110961c3.692089 0 7.071046-0.923022 10.133801-2.769067 3.063779-1.845021 5.51869-4.143367 7.364735-6.891967 1.847068-2.750647 3.075035-5.66707 3.682879-8.749268 0.608867-0.608867 0.913812-1.531889 0.913812-2.769067 7.363711-69.976748-17.186428-109.874433-73.650417-119.695103-16.576537-3.063779-31.925107-3.367701-46.045709-0.912789-4.300956 0-7.983835 1.070378-11.04659 3.210112-3.063779 2.140757-5.676279 4.898567-7.836479 8.278547-2.160199 3.377934-3.230578 6.904247-3.210112 10.57587 0 6.147 2.15099 11.360745 6.451946 15.642259 4.300956 4.281513 9.515724 6.432503 15.643282 6.451946 47.88152-11.056823 73.658603 4.290723 77.331249 46.045709 1.237177 10.428513 0.618077 20.24816-1.855254 29.458939 0 6.148024 2.15099 11.361769 6.451946 15.643282 4.299933 4.281513 9.515724 6.432503 15.642259 6.451946L768.695337 470.110961 768.695337 470.110961zM753.052055 210.510458c-27.005051-6.147-63.22088-4.919033-108.648512 3.683902-0.607844 0-1.226944 0.303922-1.855254 0.912789l-0.912789 1.855254-0.912789 0.912789c-6.755868 1.846044-12.284791 5.685489-16.585747 11.519358-4.300956 5.833869-6.450922 12.128225-6.450922 18.883069 0 9.210779 3.072989 16.880459 9.219989 23.008017 6.147 6.128581 13.511735 9.201569 22.095227 9.219989l2.768043 0c0.608867 0 1.9934-0.303922 4.154623-0.912789 2.160199-0.607844 4.457522-1.070378 6.891967-1.384533 2.435469-0.314155 5.046946-0.932232 7.836479-1.855254 2.788509-0.923022 5.244444-1.846044 7.365758-2.769067 2.12029-0.921999 6.264681-1.384533 12.432147-1.384533 6.167466 0 13.688767 0.462534 22.565948 1.384533 8.877181 0.923022 18.697851 3.221368 29.459962 6.892991 10.763135 3.672646 21.505803 8.278547 32.229029 13.81668 10.723226 5.53711 21.465894 13.20679 32.229029 23.008017 10.763135 9.800203 20.122293 21.152762 28.075429 34.054607 15.96767 36.21583 19.041682 71.204715 9.219989 104.965633 0 0.608867-0.156566 1.227967-0.470721 1.856277-0.314155 0.62831-0.774643 2.160199-1.38351 4.595668-0.608867 2.435469-1.227967 4.732791-1.855254 6.892991-0.629333 2.160199-1.24741 4.919033-1.856277 8.278547-0.608867 3.358491-0.912789 6.274914-0.912789 8.749268 0 5.51869 1.531889 10.123568 4.596691 13.815657 3.063779 3.692089 6.904247 6.304589 11.519358 7.836479 4.615111 1.531889 9.987468 2.297322 16.115026 2.296299 17.185404 0 27.309996-10.438747 30.372751-31.31624 7.364735-23.940249 11.509125-46.801932 12.432147-68.581981 0.924045-21.782096-0.607844-40.958854-4.595668-57.534368-3.987824-16.575514-9.968026-32.072463-17.941628-46.487777-7.972579-14.415314-17.184381-26.690896-27.633361-36.823674-10.447956-10.133801-22.11467-19.34458-34.998095-27.633361-12.883425-8.287757-25.315572-14.887059-37.296441-19.796882-11.979846-4.909823-24.411993-8.896624-37.295418-11.960403L753.052055 210.508411 753.052055 210.510458z" p-id="1463"></path></svg></span><span class="username">diabloneo</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Archive diabloneo's articles.
</p>
      </div>
    </div>

  </div>

</footer>

    
      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78067453-1', 'auto');
  ga('send', 'pageview');

</script>

    
  </body>

</html>
